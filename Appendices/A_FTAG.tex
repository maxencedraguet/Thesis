\chapter{Flavour Tagging}
\ChapFrame
\textit{This Appendix lists some additional results in support of Chapter \ref{chap-ftag}.}

\section{Understanding DIPS}\label{app-DIPS-perf}
\begin{figure}[h!]
  \center
  \begin{minipage}[c]{0.7\textwidth}
    \includegraphics[width=\textwidth]{Images/FTAG/dipsSaliency.png}
  \end{minipage}
  \begin{minipage}[c]{0.25\textwidth}
    \caption{Saliency map for $b$-tagging with 8 tracks sorted by $|S_{d_0}|$ and indexed by $i$, showing the gradient of the discriminant $D_b$ with respect to the $k$ track features $x_{ik}$ \cite{ATL-PHYS-PUB-2020-014}.} 
  \label{fig:dipsSaliency}
  \end{minipage}
\end{figure}

How does \gls{dips} work under the hood? The interpretability of machine learning models is an active area of research. Several effective approaches exist to gauge the importance of the input on the prediction. Figure~\ref{fig:dipsSaliency} presents the result of applying the \textit{saliency maps} technique \cite{Simonyan2013DeepIC}. Using the $b$-tagging discriminant $D_b$ of Equation \ref{bdisc} at a fixed efficiency of 77\%, the average importance of each feature in the track inputs is assessed by averaging the gradient of the discriminant with respect to the track features over a set of $N$ jets with strictly 8 associated tracks failing the threshold:
\begin{equation}
  \frac{\partial D_b}{\partial x_{ik}} = \frac{1}{N} \sum_{j=1}^N \frac{\partial D_b^{j}}{\partial x_{ik}^{j}},
\end{equation} 
where $i$ indexes the 8 tracks, $j$ indexes the jet in the sample of size $N$, $x_{ik}$ is the $k^{th}$ feature of the $i^{th}$ track \cite{ATL-PHYS-PUB-2020-014}. This process effectively probes the linear sensitivity of the discriminant on the track features. Using the saliency map, one can infer what features to modify to correct the failed tag assigned to the $b$-jets sample. The most sensitive parameters are measured to be the \gls{ip} significances of the first five tracks, and the logarithm of the $p_T^{\textrm{frac}}$ and $\Delta R$ of the track with largest $|s_{d_0}|$. This observation is physically motivated by the dynamic of the harder fragmentation of $b$-quarks, compared to light- and $c$-quarks. Negative gradients are measured for shared and split hits observables, translating into a further incorrect discriminant under a linear increase of these features. This is also physically motivated, as higher counts can be traced back to denser event environments where random combinations of hits to form tracks are more likely. However, total hit counts in the different tracker layers have a small positive impact, as these correlate with the reconstruction of the \gls{ip} parameters.

\section{DIPS with Variable Radius Jets}\label{ap-DIPSVR}
This section of the Appendix displays more information on the variable radius (\gls{vr}) jet training of \gls{dips}. The samples distributions are shown in Figure \ref{apfig:vrjetdist}.

\section{DL1d with Variable Radius Jets}\label{ap-DL1dVR}
This section presents some plots on the VR-training of DL1d. Figures \ref{fig:dl1dVRROC} and \ref{fig:dl1dVRROCgrav} present the $b$-tagging \gls{roc} curves of the different models introduced in Chapter \ref{sec:VRdl1dTrain}. Figure \ref{apfig:DL1dVRscanf} displays some flavour fractions scans for the $b$-tagging and $c$-tagging. 

\clearpage
%\vspace{-0.3cm}
\begin{figure}[h!]
  \centering
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/ttb.png}
    \caption{$t\bar{t}$, $f_c = 0.018$ for DL1d.}
    \label{fig:dl1dVRROCtt}
  \end{subfigure}
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/zpb.png}
    \caption{$Z'$, $f_c = 0.018$ for DL1d.}
    \label{fig:dl1dVRROCzp}
  \end{subfigure} \\
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/ttbupf.png}
    \caption{$t\bar{t}$, $f_c = 0.1$ for DL1d.}
    \label{fig:dl1dVRROCttc}
  \end{subfigure}
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/zpbupf.png}
    \caption{$Z'$, $f_c = 0.1$ for DL1d.}
    \label{fig:dl1dVRROCzpc}
  \end{subfigure}
  \caption{ROC curves for $b$-tagging. Top row uses $f_c = 0.018$ for DL1d, and bottom row $f_c = 0.1$ (GN1 $f_c = 0.05$ everywhere). The VR-jets DL1d model is in blue, a pre-release VR-trained GN1 in orange, DL1r trained on VR-jets in green, and the PFlow DL1d in red.}
  \label{fig:dl1dVRROC}
\end{figure}

\begin{figure}[h!]
  \centering
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/grb.png}
    \caption{DL1d $f_c = 0.018$.}
    \label{fig:dl1dVRROCgr}
  \end{subfigure}
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[width=\textwidth]{Images/FTAG/VRDL1d/ROC/grbupf.png}
    \caption{DL1d $f_c = 0.1$.}
    \label{fig:dl1dVRROCgrc}
  \end{subfigure}
  \caption{ROC curves for $b$-tagging. Similar to Figure~\ref{fig:dl1dVRROC} for the graviton process.}
  \label{fig:dl1dVRROCgrav}
\end{figure}

\clearpage
\begin{figure}[h!]
  \centering
  \begin{subfigure}[b]{0.98\textwidth}
      \centering
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/hspt.png}
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/hseta.png}
      \caption{Hybrid sample.} 
      \label{apfig:vrjetdisth}
  \end{subfigure}\\
  \begin{subfigure}[b]{0.98\textwidth}
      \centering
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/ttpt.png}
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/tteta.png}
      \caption{$t\bar{t}$ sample.} 
      \label{apfig:vrjetdistt}
  \end{subfigure}\\
  \begin{subfigure}[b]{0.98\textwidth}
      \centering
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/zppt.png}
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/zpeta.png}
      \caption{$Z'$ sample.} 
      \label{apfig:vrjetdiszp}
  \end{subfigure}\\
  \begin{subfigure}[b]{0.98\textwidth}
      \centering
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/grpt.png}
      \includegraphics[width=0.48\textwidth]{Images/FTAG/VRDips/JetDist/greta.png}
      \caption{Graviton sample.} 
      \label{apfig:vrjetdisgr}
  \end{subfigure}
  \caption{Distributions for the \gls{vr}-jet training of jets $p_T$ (left) and $|\eta|$ (right).}
  \label{apfig:vrjetdist}
\end{figure} 

\begin{figure}[h!]
  \centering
  \begin{subfigure}[b]{\textwidth}
      \centering
      \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac/cf_ttbar_200.png}
      \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac/cf_zpext_200.png}
      \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac/cf_graviton_200.png}
      \caption{Flavour fraction $f_c^b$ for $b$-tagging scans.} 
      \label{fig:DL1dVRscanfb}
  \end{subfigure}\\
  \begin{subfigure}[b]{\textwidth}
    \centering % UNreadable: increase font size
    \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac_c/cf_ttbar_2000.png}
    \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac_c/cf_zpext_2000.png}
    \includegraphics[width=0.32\textwidth]{Images/FTAG/VRDL1d/scansfraction/thesis_plot_frac_c/cf_graviton_2000.png}
    \caption{Flavour fraction $f_b^c$ for $c$-tagging scans.} 
    \label{fig:DL1dVRscanfc}
\end{subfigure}
  \caption{The flavour fractions scans of the VR- and PFlow-trained DL1d model in blue and red respectively: left is $t\bar{t}$, centre $Z'$, and right the graviton test samples. The chosen values are marked on the curves, displaying on the $y$-axis the $c$-rejection ($b$-rejection) for $b$-tagging ($c$-tagging) vs the light-rejection on the $x$ axis at a fixed working point of 77\% (33\%). Increasing $f_c$ or $f_b$ shifts the marker upwards along the curves. }
  \label{apfig:DL1dVRscanf}
\end{figure} 

\newpage
\section{GN2 public plots}
A comparison of the global performance of this \gls{gn2} model to the \gls{dl1d} and \gls{gn1} models is displayed in the $b$- and $c$-tagging \gls{roc} curves of Figures \ref{fig:GN2rocb} and \ref{fig:GN2rocc}. These results are taken from Ref \cite{ATL-PLOT-FTAG-2023-01}, for which the \gls{dl1d} model was retrained on the same dataset as \gls{gn2}, and the \gls{dl1r} and \gls{gn1} models are taken from Chapter \ref{chap-GN1}. \gls{gn2} delivers yet another significant boost to performance, drasticaly surpassing the \gls{gn1} rejections at all efficiencies considered. The largest improvement is again obtained at lower $b$-jet efficiencies. Compared to \gls{gn1}, \gls{gn2} delivers $\times 1.5$ ($\times 1.7$) the $c$-rejection (light-rejection) on $t\bar{t}$ at the 70\% $b$-tagging \gls{wp} and $\times 1.75$ ($\times 1.2$) on $Z'$ at 30\% \gls{wp}. With respect to \gls{dl1d}, the gains in $c$-rejection (light-rejection) are respectively close to $\times 3$ ($\times 2$) for $t\bar{t}$ and $\times 3.4$ ($\times 4$) on $Z'$ samples. Concerning $c$-tagging, a similar large performance gained is obtained by the new \gls{gnn} family over \gls{dl1d}, although the change on the $t\bar{t}$ is more impressive for the $b$-jet ratio than for light-jet. This indicates a non-optimal choice for the flavour fraction $f^c_b$, which was set at 0.2 for all models.

\section{GN2 supporting plots}\label{app-GN2sup}
This section presents more plots in support of Chapter \ref{chap-GN2}. Figure \ref{apfig:GNxptc_eff} presents the $c$-tagging efficiency per bin for an overall $c$-tagging working point of 30\% per region displayed. Figure \ref{apfig:GNxptc_efffixedl} presents the $c$-tagging efficiency per bin for a per bin light-rejection of 50 for $t\bar{t}$ and 10 for $Z'$. The \gls{gn2} performance dominates across the board, except for the highest energy bin of the $Z'$. Figures \ref{apfig:GNxptc_efffixedl} presents the $c$- and light-rejection at an inclusive 70\% $b$-tagging \gls{wp}. The equivalent information for $c$-tagging at a $c$-tagging \gls{wp} of 30\% is displayed in Figures \ref{apfig:GNxptc_brej} and \ref{apfig:GNxptc_urej} for $b$- and light-rejection. 

\begin{center}
  \vspace{-1.cm}
  \begin{figure}[h!]
  \centerline{
  \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/ROCpublic/ttb.png}
  \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/ROCpublic/zpb.png}
  }
  \caption{The $c$- and light-rejections as a function of the $b$-jet tagging efficiency in the $t\bar{t}$ with $20 < p_T < 250$ GeV (left) and $Z'$ with $250 < p_T < 6000$ GeV (right) test samples, from \cite{ATL-PLOT-FTAG-2023-01}. Models compared are DL1d in orange, GN1 in turquoise, and GN2 in blue. The bottom plots show the ratio with respect to the DL1d performance. Flavour fractions are set at $f^b_c = 0.018$ for DL1d, 0.05 for GN1, and 0.1 for GN2. Shaded regions represent the binominal error band.}
  \label{apfig:GN2rocb}
  \bigskip
  \centerline{
  \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/ROCpublic/ttc.png}
  \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/ROCpublic/zpc.png}
  }
  \caption{The $b$- and light-rejections as a function of the $c$-jet tagging efficiency in the $t\bar{t}$ with $20 < p_T < 250$ GeV (left) and $Z'$ with $250 < p_T < 6000$ GeV (right) test samples, from \cite{ATL-PLOT-FTAG-2023-01}. Models compared are DL1d in orange, GN1 in turquoise, and GN2 in blue. The bottom plots show the ratio with respect to the DL1d performance. Flavour fractions are set at $f^c_b = 0.2$ for all taggers. Shaded regions represent the binominal error band.}
  \label{apfig:GN2rocc}
  \end{figure}
\end{center}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_c_eff.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_c_eff.png}
    \caption{Comparing the different models $c$-tagging efficiency as a function of jet $p_T$ for the inclusive $c$-tagging 30\% working point on the $t\bar{t}$ (left) and $Z'$ (right). The flavour fraction is set at $f^c_b = 0.2$ for all taggers.}
    \label{apfig:GNxptc_eff}
\end{figure} 

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_c_eff_fixedlight.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_c_eff_fixedlight.png}
    \caption{Comparing the different models $c$-tagging efficiency as a function of jet $p_T$ at a fixed light-jet rejection per bin of 50 for the $t\bar{t}$ (left) and 10 for the $Z'$ (right) test samples. The flavour fraction is set at $f^c_b = 0.2$ for all taggers.}
    \label{apfig:GNxptc_efffixedl}
  \end{figure} 

% Rej c - btagging
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_c_rej.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_c_rej.png}
    \caption{Comparing the different models $c$-rejection as a function of jet $p_T$ for the $b$-tagging inclusive 70\% working point on the $t\bar{t}$ (left) and 30\% working point on $Z'$ (right). The flavour fraction is set at $f^b_c = 0.018$ for DL1r and DL1d, 0.05 for GN1, and 0.1 for GN2.}
    \label{apfig:GNxptb_crej}
  \end{figure} 
  
  % Rej light - btagging
  \begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_light_rej.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_light_rej.png}
    \caption{Comparing the different models light-rejection as a function of jet $p_T$ for the $b$-tagging inclusive 70\% working point on the $t\bar{t}$ (left) and 30\% working point on $Z'$ (right). The flavour fraction is set at $f^b_c = 0.018$ for DL1r and DL1d, 0.05 for GN1, and 0.1 for GN2.}
    \label{apfig:GNxptb_urej}
  \end{figure} 
  
% Rej b - ctagging
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_b_rej_c.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_b_rej_c.png}
    \caption{Comparing the different models $b$-rejection as a function of jet $p_T$ for the $c$-tagging inclusive 30\% working point on the $t\bar{t}$ (left) and $Z'$ (right). The flavour fraction is set at $f^c_b = 0.2$ for all taggers.}
    \label{apfig:GNxptc_brej}
  \end{figure} 
  
  % Rej light - ctagging
  \begin{figure}[h!]
    \centering
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_ttbar_light_rej_c.png}
    \includegraphics[width=0.48\textwidth]{Images/FTAG/GN/GN2/pt_plots/pt_zp_light_rej_c.png}
    \caption{Comparing the different models light-rejection as a function of jet $p_T$ for the $c$-tagging inclusive 30\% working point on the $t\bar{t}$ (left) and  $Z'$ (right). The flavour fraction is set at $f^c_b = 0.2$ for all taggers.}
    \label{apfig:GNxptc_urej}
  \end{figure} 

\newpage  
\input{Appendices/GN2x.tex}